<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§ÛŒØªØ¨Ø§Ù„ Ø±ÙˆÛŒØ§Ù„</title>
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;700;900&display=swap" rel="stylesheet">
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Vazirmatn', sans-serif; }
        
        :root {
            --gold: #FFD700;
            --gold-30: rgba(255, 215, 0, 0.3);
            --bg-primary: #0A0A0F;
            --text-primary: #FFFFFF;
            --text-secondary: #888888;
            --error: #FF4444;
            --success: #00FF88;
        }
        
        body {
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
        }
        
        #loading-screen {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: var(--bg-primary);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 99999;
        }
        
        .loading-logo {
            font-size: 4rem;
            font-weight: 900;
            color: var(--gold);
            margin-bottom: 30px;
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid var(--gold-30);
            border-top-color: var(--gold);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        .loading-text {
            margin-top: 20px;
            color: var(--text-secondary);
            font-size: 14px;
        }
        
        .loading-error {
            margin-top: 20px;
            color: var(--error);
            font-size: 12px;
            max-width: 80%;
            text-align: center;
            line-height: 1.6;
            display: none;
        }
        
        .debug-info {
            margin-top: 20px;
            color: var(--text-secondary);
            font-size: 11px;
            max-width: 90%;
            text-align: left;
            background: rgba(0,0,0,0.5);
            padding: 10px;
            border-radius: 8px;
            display: none;
        }
        
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div id="loading-screen">
        <div class="loading-logo">ðŸ‘‘ Ø§ÛŒØªØ¨Ø§Ù„</div>
        <div class="loading-spinner" id="spinner"></div>
        <div class="loading-text" id="statusText">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...</div>
        <div class="loading-error" id="errorText"></div>
        <div class="debug-info" id="debugInfo"></div>
    </div>

    <div id="app"></div>

    <script>
        // Debug logger
        function log(msg) {
            console.log(msg);
            const debug = document.getElementById('debugInfo');
            debug.style.display = 'block';
            debug.innerHTML += msg + '<br>';
        }

        function showError(msg) {
            document.getElementById('spinner').style.display = 'none';
            document.getElementById('statusText').style.display = 'none';
            document.getElementById('errorText').style.display = 'block';
            document.getElementById('errorText').textContent = msg;
            log('ERROR: ' + msg);
        }

        function updateStatus(msg) {
            document.getElementById('statusText').textContent = msg;
            log(msg);
        }

        // Check auth
        function checkAuth() {
            const testUser = localStorage.getItem('eitabal_user');
            log('checkAuth: testUser=' + (testUser ? 'exists' : 'null'));
            return testUser;
        }

        // Load script with detailed error
        function loadScript(src) {
            return new Promise((resolve, reject) => {
                log('Loading: ' + src);
                const script = document.createElement('script');
                script.src = src;
                script.async = false; // Load sequentially
                
                script.onload = () => {
                    log('âœ… Loaded: ' + src);
                    resolve();
                };
                
                script.onerror = (e) => {
                    log('âŒ Failed: ' + src);
                    reject(new Error('Failed to load: ' + src));
                };
                
                document.head.appendChild(script);
            });
        }

        // Initialize
        async function initApp() {
            log('=== Starting App ===');
            
            if (!checkAuth()) {
                log('No auth, redirecting...');
                window.location.href = './index.html';
                return;
            }

            try {
                // Load CSS
                updateStatus('Loading CSS...');
                const css1 = document.createElement('link');
                css1.rel = 'stylesheet';
                css1.href = '02-style.css';
                document.head.appendChild(css1);

                const css2 = document.createElement('link');
                css2.rel = 'stylesheet';
                css2.href = '03-variables.css';
                document.head.appendChild(css2);

                // Load Core
                updateStatus('Loading Core...');
                await loadScript('core/04-engine.js');
                
                // Check if Royal exists
                log('Checking Royal...');
                if (typeof Royal === 'undefined') {
                    throw new Error('Royal is undefined after loading 04-engine.js');
                }
                log('Royal found: ' + typeof Royal);
                log('Royal.init: ' + typeof Royal.init);

                await loadScript('core/05-router.js');
                await loadScript('core/06-events.js');
                await loadScript('core/07-utils.js');
                await loadScript('core/08-http.js');
                await loadScript('core/09-database.js');

                // Load Modules
                updateStatus('Loading Modules...');
                await loadScript('modules/10-auth.js');
                await loadScript('modules/11-header.js');
                await loadScript('modules/12-sidebar.js');
                await loadScript('modules/13-bottom-nav.js');
                await loadScript('modules/14-extra-menu.js');
                await loadScript('modules/15-streak.js');
                await loadScript('modules/16-predict.js');
                await loadScript('modules/17-team.js');
                await loadScript('modules/18-vote.js');
                await loadScript('modules/19-tap.js');
                await loadScript('modules/20-shop.js');
                await loadScript('modules/21-chat.js');
                await loadScript('modules/22-league.js');
                await loadScript('modules/23-news.js');
                await loadScript('modules/24-payment.js');

                // Load Pages
                updateStatus('Loading Pages...');
                await loadScript('pages/25-home.js');
                await loadScript('pages/26-league-page.js');
                await loadScript('pages/27-matches-page.js');
                await loadScript('pages/28-news-page.js');
                await loadScript('pages/29-predict-page.js');
                await loadScript('pages/30-team-page.js');
                await loadScript('pages/31-vote-page.js');
                await loadScript('pages/32-tap-page.js');
                await loadScript('pages/33-shop-page.js');
                await loadScript('pages/34-chat-page.js');

                // Initialize
                updateStatus('Initializing Royal...');
                if (Royal && Royal.init) {
                    await Royal.init();
                    log('âœ… Royal initialized');
                    
                    setTimeout(() => {
                        document.getElementById('loading-screen').style.opacity = '0';
                        setTimeout(() => {
                            document.getElementById('loading-screen').style.display = 'none';
                        }, 500);
                    }, 500);
                } else {
                    throw new Error('Royal.init not found');
                }

            } catch (error) {
                console.error(error);
                showError('Ø®Ø·Ø§: ' + error.message);
            }
        }

        // Start
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initApp);
        } else {
            initApp();
        }
    </script>

</body>
</html>
